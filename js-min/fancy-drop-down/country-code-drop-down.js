YUI.add("country-code-drop-down",function(a){var b;if(a.one("html").hasClass("modern")){var c,d=1;c=function(b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=[],B=[],C=0,D=[],E="";c=b,e=c.all("option"),f=c.get("selectedIndex"),g=a.one("#"+b.getAttribute("mobile-field-id")),i=g.get("parentNode").one(".placeholder"),j="selected-country-code-"+d,m="country-codes-menu-"+d,p=function(){A.push('<div id="'+j+'" class="column selected-country-code">'),A.push('<a href="#'+m+'" role="menuitem" aria-haspopup="true" aria-labelledby="country-name" tabindex="0">'),A.push('<span class="flag-'),A.push(e.item(f).getAttribute("data-country-code")),A.push('"></span>&nbsp;<span class="country-code-arrow-container"><span class="country-code-arrow"></span></span>&nbsp;'),A.push('<span id="country-name" class="clipped">'+e.item(f).get("innerHTML")+"</span>"),A.push(e.item(f).get("value")),A.push("</a>"),A.push("</div>"),A=A.join(""),g.get("parentNode").insertBefore(A,g.get("parentNode").one("label"))},p(),k=a.one("#"+j),r=function(){l=k.get("offsetWidth"),"ltr"===a.one("body").getStyle("direction")?(g.setStyle("paddingLeft",l),i&&i.setStyle("paddingLeft",l)):(g.setStyle("paddingRight",l),i&&i.setStyle("paddingRight",l)),g.setAttribute("placeholder",g.getAttribute("placeholder"))},r(),h=9===a.UA.ie?g.get("offsetWidth")+17+"px":g.get("offsetWidth")+"px",q=function(){B.push('<div class="country-codes-container" id="'+m+'" style="width:'+h+'">'),B.push("<ul>"),e.each(function(a){B.push("<li>"),B.push('<a href="#" role="menuitem" data-code="'+a.get("value")+'">'),B.push('<span class="flag-'),B.push(a.getAttribute("data-country-code")),B.push('"></span>&nbsp;&nbsp;'),B.push(a.get("innerHTML")),B.push("</a>"),B.push("</li>")}),B.push("</ul>"),B.push("</div>"),B=B.join(""),k.append(B),c.hide()},q(),n=a.one("#"+m),v=function(a){var b=a.one("a").get("innerHTML").replace(/<.*>&nbsp;&nbsp;/g,"").toLowerCase();D.push(b)},n.all("li").each(function(a){v(a,C),C+=1}),s=function(b){b.halt(),f=c.get("selectedIndex"),n.setStyle("display","block"),n.all("ul li").item(f).one("a").focus(),g.addClass("highlight-border"),o||(o=a.UA.ie?8===a.UA.ie?parseInt(n.one("ul li a").get("offsetHeight"),0)-.27:parseInt(n.one("ul li a").get("offsetHeight"),0)+.42:parseInt(n.one("ul li a").get("offsetHeight"),0)),n.set("scrollTop",o*f),a.fire("hide-country-codes-container",null,n)},k.on("click",s),k.on("keydown",function(a){(40===a.keyCode||38===a.keyCode)&&(a.halt(),s(a))}),u=function(){n.all("ul li").item(f).one("a").focus(),n.set("scrollTop",o*f)},n.on("keydown",function(a){switch((38===a.keyCode||40===a.keyCode||9===a.keyCode)&&a.halt(),menuSize=n.all("ul li").size(),a.keyCode){case 38:0===f&&(f=menuSize),f-=1,u();break;case 40:f===menuSize-1&&(f=-1),f+=1,u();break;case 9:g.focus(),n.setStyle("display","none");break;case 27:k.one("a").focus(),n.setStyle("display","none")}}),w=function(a){for(var b=E.length;a>=0&&D[a].substr(0,b)===E;)a-=1;return a+1},x=function(){for(var a,b,c=0,d=D.length-1,e=E.length;d>=c;)if(a=0|(c+d)/2,b=D[a].substr(0,e),E>b)c=a+1;else{if(!(b>E))return w(a);d=a-1}return-1},n.on("keypress",function(a){z=(new Date).getTime(),y&&z-y>500&&(E=""),y=z,E+=String.fromCharCode(a.keyCode),f=x(),-1!==f&&u()}),n.on("mouseover",function(a){a.halt(),a.target.focus(),f=n.all("li").indexOf(a.target.get("parentNode")),g.addClass("highlight-border")}),t=function(b){b.halt();var d=b.target.getAttribute("data-code"),e=[];e.push('<span class="'),e.push(b.target.one("span").get("className")),e.push('"></span>&nbsp;<span class="country-code-arrow-container"><span class="country-code-arrow"></span></span>&nbsp;'),e.push(d),k.one("a").set("innerHTML",e.join("")),r(),n.setStyle("display","none"),f=n.all("li").indexOf(b.target.get("parentNode")),c.set("selectedIndex",f),a.fire("country-code-change",null,c),g.focus()},n.all("li").on("click",t),n.all("li").on("mousedown",t),n.all("a").on("blur",function(){g.removeClass("highlight-border")}),n.all("a").on("focus",function(a){a.halt(),g.addClass("highlight-border")}),k.one("a").on("focus",function(){g.addClass("highlight-border")}),k.one("a").on("blur",function(){g.removeClass("highlight-border")}),g.on("blur",function(){this.removeClass("highlight-border")}),d++},a.all("[data=country-code-drop-down]").each(function(a){c(a)}),b=a.all(".country-codes-container"),hideCountryCodesContainer=function(a){b.each(function(b){b!==a&&"block"===b.getStyle("display")&&b.setStyle("display","none")})},a.on("click",hideCountryCodesContainer,"body"),a.on("hide-country-codes-container",function(a,b){hideCountryCodesContainer(b)})}});